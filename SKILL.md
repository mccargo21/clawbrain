---
name: clawbrain
description: "Claw Brain - Personal AI Memory System for OpenClaw/ClawDBot. Provides memory, personality, bonding, and learning capabilities. Auto-refreshes on service restart."
metadata: {"openclaw":{"emoji":"ðŸ§ ","category":"memory","provides":{"slot":"memory"},"events":["gateway:startup","agent:bootstrap","command:new"],"requires":{"files":["clawbrain.py"]},"install":[{"id":"git","kind":"git","url":"https://github.com/clawcolab/clawbrain.git","label":"Install Claw Brain (git)"}]}}
---

# Claw Brain Skill ðŸ§ 

Personal AI Memory System with Soul, Bonding, and Learning for OpenClaw/ClawDBot.

> **Auto-Refresh on Restart**: ClawBrain automatically detects and refreshes memory when the OpenClaw service restarts.

## Features

- ðŸŽ­ **Soul/Personality** - 6 evolving traits (humor, empathy, curiosity, creativity, helpfulness, honesty)
- ðŸ‘¤ **User Profile** - Learns user preferences, interests, communication style
- ðŸ’­ **Conversation State** - Real-time mood detection and context tracking
- ðŸ“š **Learning Insights** - Continuously learns from interactions and corrections
- ðŸ§  **get_full_context()** - Everything for personalized responses
- ðŸ”„ **Auto-Refresh** - Automatically refreshes memory on OpenClaw service restart
- ðŸ”Œ **Plugin System** - Full OpenClaw plugin with hooks and tools

---

## OpenClaw Integration (Recommended)

ClawBrain integrates directly with OpenClaw as a memory plugin. On service restart, it automatically:
1. Detects existing brain instance (SQLite/PostgreSQL)
2. Loads and indexes recent memories
3. Injects memory context into agent bootstrap
4. Provides `brain_recall`, `brain_remember`, `brain_context`, `brain_learn` tools

### Quick Setup for OpenClaw

```bash
# 1. Clone to OpenClaw plugins directory
cd ~/.openclaw/plugins
git clone https://github.com/clawcolab/clawbrain.git

# 2. Enable the plugin in openclaw.json
openclaw config set plugins.entries.clawbrain.enabled true
openclaw config set plugins.slots.memory clawbrain

# 3. Enable boot-md hook for auto-refresh
openclaw hooks enable boot-md

# 4. Restart gateway
openclaw gateway restart
```

### OpenClaw Configuration

Add to `~/.openclaw/openclaw.json`:

```json
{
  "plugins": {
    "entries": {
      "clawbrain": {
        "enabled": true,
        "settings": {
          "storage_backend": "auto",
          "sqlite_path": "~/.openclaw/workspace/brain.db",
          "auto_recall": true,
          "recall_limit": 5,
          "agent_id": "assistant",
          "user_id": "user"
        }
      }
    },
    "slots": {
      "memory": "clawbrain"
    }
  },
  "hooks": {
    "internal": {
      "enabled": true
    }
  }
}
```

### OpenClaw Tools

| Tool | Description |
|------|-------------|
| `brain_recall` | Search memories with query, type, tags |
| `brain_remember` | Store new memories with tags |
| `brain_context` | Get full context for personalization |
| `brain_learn` | Learn user preferences |
| `brain_health` | Check brain status |

### OpenClaw Events

| Event | Action |
|-------|--------|
| `gateway:startup` | Initialize brain, refresh memories |
| `agent:bootstrap` | Inject MEMORY.md with context |
| `command:new` | Save session to memory |

---

## Installation

### Option 1: Git Clone (Recommended for ClawDBot)

```bash
# Clone into ClawDBot workspace
git clone https://github.com/clawcolab/clawbrain.git ClawBrain
```

### Option 2: pip install

```bash
pip install git+https://github.com/clawcolab/clawbrain.git
```

---

## ClawDBot Setup

### 1. Install the Skill

```bash
# Clone to your ClawDBot workspace
cd /path/to/your/clawdbot
git clone https://github.com/clawcolab/clawbrain.git ClawBrain
```

### 2. Import in Your Bot

Add to your bot's main file (e.g., `main.py`):

```python
import sys
sys.path.insert(0, "ClawBrain")

from clawbrain import Brain

# Initialize the brain
brain = Brain()

# Make it available globally or pass to handlers
app.brain = brain
```

### 3. Use in Message Handlers

```python
def handle_message(message, channel="telegram"):
    # Get user context
    context = app.brain.get_full_context(
        session_key=f"{channel}_{message.chat.id}",
        user_id=str(message.chat.id),
        agent_id="assistant",
        message=message.text
    )
    
    # Generate personalized response
    response = generate_response(context)
    
    # Store conversation
    app.brain.remember(
        agent_id="assistant",
        memory_type="conversation",
        content=message.text,
        key=f"last_message_{message.chat.id}"
    )
    
    return response
```

---

## Configuration

### Environment Variables

```bash
# PostgreSQL (optional - auto-detected)
export POSTGRES_HOST=localhost
export POSTGRES_PORT=5432
export POSTGRES_DB=brain_db
export POSTGRES_USER=brain_user
export POSTGRES_PASSWORD=your_password

# Redis (optional - auto-detected)
export REDIS_HOST=localhost
export REDIS_PORT=6379
```

### Force Storage Backend

```python
# Force SQLite (zero setup)
brain = Brain({"storage_backend": "sqlite"})

# Force PostgreSQL
brain = Brain({"storage_backend": "postgresql"})

# Auto-detect (default)
brain = Brain()
```

---

## API Reference

### Brain Class

```python
from clawbrain import Brain

brain = Brain()
```

#### Methods

| Method | Description | Returns |
|--------|-------------|---------|
| `get_full_context()` | Get all context for personalized responses | dict |
| `remember()` | Store a memory | None |
| `recall()` | Retrieve memories | List[Memory] |
| `learn_user_preference()` | Learn user preferences | None |
| `get_user_profile()` | Get user profile | UserProfile |
| `detect_user_mood()` | Detect current mood | dict |
| `detect_user_intent()` | Detect message intent | str |
| `generate_personality_prompt()` | Generate personality guidance | str |
| `health_check()` | Check backend connections | dict |
| `close()` | Close connections | None |

### get_full_context()

```python
context = brain.get_full_context(
    session_key="telegram_12345",  # Unique session ID
    user_id="username",              # User identifier
    agent_id="assistant",          # Bot identifier
    message="Hey, how's it going?" # Current message
)
```

**Returns:**
```python
{
    "user_profile": {...},        # User preferences, interests
    "mood": {"mood": "happy", ...},  # Current mood
    "intent": "question",         # Detected intent
    "memories": [...],            # Relevant memories
    "personality": "...",         # Personality guidance
    "suggested_responses": [...]  # Response suggestions
}
```

### detect_user_mood()

```python
mood = brain.detect_user_mood("I'm so excited about this!")
# Returns: {"mood": "happy", "confidence": 0.9, "emotions": ["joy", "anticipation"]}
```

### detect_user_intent()

```python
intent = brain.detect_user_intent("How does AI work?")
# Returns: "question"

intent = brain.detect_user_intent("Set a reminder for 3pm")
# Returns: "command"

intent = brain.detect_user_intent("I had a great day today")
# Returns: "casual"
```

---

## Example: Full Integration

```python
import sys
sys.path.insert(0, "ClawBrain")

from clawbrain import Brain

class AssistantBot:
    def __init__(self):
        self.brain = Brain()
    
    def handle_message(self, message, chat_id):
        # Get context
        context = self.brain.get_full_context(
            session_key=f"telegram_{chat_id}",
            user_id=str(chat_id),
            agent_id="assistant",
            message=message
        )
        
        # Generate response using context
        response = self.generate_response(context)
        
        # Learn from interaction
        self.brain.learn_user_preference(
            user_id=str(chat_id),
            pref_type="interest",
            value="AI"
        )
        
        return response
    
    def generate_response(self, context):
        # Use user preferences
        name = context["user_profile"].name or "there"
        mood = context["mood"]["mood"]
        
        # Personalized response
        if mood == "frustrated":
            return f"Hey {name}, I'm here to help. Let me assist you."
        else:
            return f"Hi {name}! How can I help you today?"
    
    def shutdown(self):
        self.brain.close()
```

---

## Storage Backends

### SQLite (Default - Zero Setup)

No configuration needed. Data stored in local SQLite database.

```python
brain = Brain({"storage_backend": "sqlite"})
```

**Best for:** Development, testing, single-user deployments

### PostgreSQL + Redis (Production)

Requires PostgreSQL and Redis servers.

```python
brain = Brain()  # Auto-detects
```

**Requirements:**
- PostgreSQL 14+
- Redis 6+
- Python packages: `psycopg2-binary`, `redis`

```bash
pip install psycopg2-binary redis
```

**Best for:** Production, multi-user, high-concurrency

---

## Files

- `clawbrain.py` - Main Brain class with all features
- `__init__.py` - Module exports
- `SKILL.md` - This documentation
- `skill.json` - ClawdHub metadata
- `README.md` - Quick start guide

---

## Troubleshooting

### ImportError: No module named 'clawbrain'

```bash
# Ensure ClawBrain folder is in your path
sys.path.insert(0, "ClawBrain")
```

### PostgreSQL connection failed

```bash
# Check environment variables
echo $POSTGRES_HOST
echo $POSTGRES_PORT

# Verify PostgreSQL is running
pg_isready -h $POSTGRES_HOST -p $POSTGRES_PORT
```

### Redis connection failed

```bash
# Check Redis is running
redis-cli ping
```

### Using SQLite (fallback)

If PostgreSQL/Redis are unavailable, Claw Brain automatically falls back to SQLite:

```python
brain = Brain({"storage_backend": "sqlite"})
```

---

## Learn More

- **Repository:** https://github.com/clawcolab/clawbrain
- **README:** See README.md for quick start
- **Issues:** Report bugs at GitHub Issues
